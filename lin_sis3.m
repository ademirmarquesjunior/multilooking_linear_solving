iter=0;
n=0;
img_out=zeros(3*size(img1));
for i=1:size(img1,1)-1
	for j=1:size(img1,2)-1
		iter=iter+1
%%%  1  %%%
		im1=img1(i,j); im2=img2(i,j); im3=img3(i,j); im4=img4(i,j); im5=img5(i,j); im6=img6(i,j); im7=img7(i,j); im8=img8(i,j); im9=img9(i,j);
		im1=double(im1); im2=double(im2); im3=double(im3); im4=double(im4); im5=double(im5); im6=double(im6); im7=double(im7); im8=double(im8); im9=double(im9);
		[x]= lin_sis_solve (im1, im2, im3, im4, im5, im6, im7, im8, im9);
		n=n+1;
		img_out(3*i-2,3*j-2,n)=x(1);
		img_out(3*i-2,3*j-1,n)=x(2);
		img_out(3*i-2,3*j,n)=x(3);
		img_out(3*i-2,3*j+1,n)=x(4);
		img_out(3*i-2,3*j+2,n)=x(5);
		img_out(3*i-1,3*j-2,n)=x(6);
		img_out(3*i-1,3*j-1,n)=x(7);
		img_out(3*i-1,3*j,n)=x(8);
		img_out(3*i-1,3*j+1,n)=x(9);
		img_out(3*i-1,3*j+2,n)=x(10);
		img_out(3*i,3*j-2,n)=x(11);
		img_out(3*i,3*j-1,n)=x(12);
		img_out(3*i,3*j,n)=x(13);
		img_out(3*i,3*j+1,n)=x(14);
		img_out(3*i,3*j+2,n)=x(15);
		img_out(3*i+1,3*j-2,n)=x(16);
		img_out(3*i+1,3*j-1,n)=x(17);
		img_out(3*i+1,3*j,n)=x(18);
		img_out(3*i+1,3*j+1,n)=x(19);
		img_out(3*i+1,3*j+2,n)=x(20);
		img_out(3*i+2,3*j-2,n)=x(21);
		img_out(3*i+2,3*j-1,n)=x(22);
		img_out(3*i+2,3*j,n)=x(23);
		img_out(3*i+2,3*j+1,n)=x(24);
		img_out(3*i+2,3*j+2,n)=x(25);
 %%%  2  %%%
		im1=img2(i,j); im2=img3(i,j); im3=img1(i,j+1); im4=img5(i,j); im5=img6(i,j); im6=img4(i,j+1); im7=img8(i,j); im8=img9(i,j); im9=img7(i,j+1);
		im1=double(im1); im2=double(im2); im3=double(im3); im4=double(im4); im5=double(im5); im6=double(im6); im7=double(im7); im8=double(im8); im9=double(im9);
		[x]= lin_sis_solve (im1, im2, im3, im4, im5, im6, im7, im8, im9);
		n=n+1;
		ii=i;
		jj=j+0.33;
		
		img_out(round(3*ii)-2, round(3*jj)-2,n)=x(1);
		img_out(round(3*ii)-2, round(3*jj)-1,n)=x(2);
		img_out(round(3*ii)-2, round(3*jj),n)=x(3);
		img_out(round(3*ii)-2, round(3*jj)+1,n)=x(4);
		img_out(round(3*ii)-2, round(3*jj)+2,n)=x(5);
		img_out(round(3*ii)-1, round(3*jj)-2,n)=x(6);
		img_out(round(3*ii)-1, round(3*jj)-1,n)=x(7);
		img_out(round(3*ii)-1,round(3*jj),n)=x(8);
		img_out(round(3*ii)-1,round(3*jj)+1,n)=x(9);
		img_out(round(3*ii)-1,round(3*jj)+2,n)=x(10);
		img_out(round(3*ii),round(3*jj)-2,n)=x(11);
		img_out(round(3*ii),round(3*jj)-1,n)=x(12);
		img_out(round(3*ii),round(3*jj),n)=x(13);
		img_out(round(3*ii),round(3*jj)+1,n)=x(14);
		img_out(round(3*ii),round(3*jj)+2,n)=x(15);
		img_out(round(3*ii)+1,round(3*jj)-2,n)=x(16);
		img_out(round(3*ii)+1,round(3*jj)-1,n)=x(17);
		img_out(round(3*ii)+1,round(3*jj),n)=x(18);
		img_out(round(3*ii)+1,round(3*jj)+1,n)=x(19);
		img_out(round(3*ii)+1,round(3*jj)+2,n)=x(20);
		img_out(round(3*ii)+2,round(3*jj)-2,n)=x(21);
		img_out(round(3*ii)+2,round(3*jj)-1,n)=x(22);
		img_out(round(3*ii)+2,round(3*jj),n)=x(23);
		img_out(round(3*ii)+2,round(3*jj)+1,n)=x(24);
		img_out(round(3*ii)+2,round(3*jj)+2,n)=x(25);
 %%%  3  %%%
		im1=img3(i,j); im2=img1(i,j+1); im3=img2(i,j+1); im4=img6(i,j); im5=img4(i,j+1); im6=img5(i,j+1); im7=img9(i,j); im8=img7(i,j+1); im9=img8(i,j+1);
		im1=double(im1); im2=double(im2); im3=double(im3); im4=double(im4); im5=double(im5); im6=double(im6); im7=double(im7); im8=double(im8); im9=double(im9);
		[x]= lin_sis_solve (im1, im2, im3, im4, im5, im6, im7, im8, im9);
		n=n+1;
		ii=i;
		jj=j+0.66;
		img_out(round(3*ii)-2,round(3*jj)-2,n)=x(1);
		img_out(round(3*ii)-2,round(3*jj)-1,n)=x(2);
		img_out(round(3*ii)-2,round(3*jj),n)=x(3);
		img_out(round(3*ii)-2,round(3*jj)+1,n)=x(4);
		img_out(round(3*ii)-2,round(3*jj)+2,n)=x(5);
		img_out(round(3*ii)-1,round(3*jj)-2,n)=x(6);
		img_out(round(3*ii)-1,round(3*jj)-1,n)=x(7);
		img_out(round(3*ii)-1,round(3*jj),n)=x(8);
		img_out(round(3*ii)-1,round(3*jj)+1,n)=x(9);
		img_out(round(3*ii)-1,round(3*jj)+2,n)=x(10);
		img_out(round(3*ii),round(3*jj)-2,n)=x(11);
		img_out(round(3*ii),round(3*jj)-1,n)=x(12);
		img_out(round(3*ii),round(3*jj),n)=x(13);
		img_out(round(3*ii),round(3*jj)+1,n)=x(14);
		img_out(round(3*ii),round(3*jj)+2,n)=x(15);
		img_out(round(3*ii)+1,round(3*jj)-2,n)=x(16);
		img_out(round(3*ii)+1,round(3*jj)-1,n)=x(17);
		img_out(round(3*ii)+1,round(3*jj),n)=x(18);
		img_out(round(3*ii)+1,round(3*jj)+1,n)=x(19);
		img_out(round(3*ii)+1,round(3*jj)+2,n)=x(20);
		img_out(round(3*ii)+2,round(3*jj)-2,n)=x(21);
		img_out(round(3*ii)+2,round(3*jj)-1,n)=x(22);
		img_out(round(3*ii)+2,round(3*jj),n)=x(23);
		img_out(round(3*ii)+2,round(3*jj)+1,n)=x(24);
		img_out(round(3*ii)+2,round(3*jj)+2,n)=x(25);
%%%  4  %%%
		im1=img4(i,j); im2=img5(i,j); im3=img6(i,j); im4=img7(i,j); im5=img8(i,j); im6=img9(i,j); im7=img1(i+1,j); im8=img2(i+1,j); im9=img3(i+1,j);
		im1=double(im1); im2=double(im2); im3=double(im3); im4=double(im4); im5=double(im5); im6=double(im6); im7=double(im7); im8=double(im8); im9=double(im9);
		[x]= lin_sis_solve (im1, im2, im3, im4, im5, im6, im7, im8, im9);
		n=n+1;
		ii=i+0.33;
		jj=j;
		img_out(round(3*ii)-2,round(3*jj)-2,n)=x(1);
		img_out(round(3*ii)-2,round(3*jj)-1,n)=x(2);
		img_out(round(3*ii)-2,round(3*jj),n)=x(3);
		img_out(round(3*ii)-2,round(3*jj)+1,n)=x(4);
		img_out(round(3*ii)-2,round(3*jj)+2,n)=x(5);
		img_out(round(3*ii)-1,round(3*jj)-2,n)=x(6);
		img_out(round(3*ii)-1,round(3*jj)-1,n)=x(7);
		img_out(round(3*ii)-1,round(3*jj),n)=x(8);
		img_out(round(3*ii)-1,round(3*jj)+1,n)=x(9);
		img_out(round(3*ii)-1,round(3*jj)+2,n)=x(10);
		img_out(round(3*ii),round(3*jj)-2,n)=x(11);
		img_out(round(3*ii),round(3*jj)-1,n)=x(12);
		img_out(round(3*ii),round(3*jj),n)=x(13);
		img_out(round(3*ii),round(3*jj)+1,n)=x(14);
		img_out(round(3*ii),round(3*jj)+2,n)=x(15);
		img_out(round(3*ii)+1,round(3*jj)-2,n)=x(16);
		img_out(round(3*ii)+1,round(3*jj)-1,n)=x(17);
		img_out(round(3*ii)+1,round(3*jj),n)=x(18);
		img_out(round(3*ii)+1,round(3*jj)+1,n)=x(19);
		img_out(round(3*ii)+1,round(3*jj)+2,n)=x(20);
		img_out(round(3*ii)+2,round(3*jj)-2,n)=x(21);
		img_out(round(3*ii)+2,round(3*jj)-1,n)=x(22);
		img_out(round(3*ii)+2,round(3*jj),n)=x(23);
		img_out(round(3*ii)+2,round(3*jj)+1,n)=x(24);
		img_out(round(3*ii)+2,round(3*jj)+2,n)=x(25);
%%%  5  %%%
		im1=img5(i,j); im2=img6(i,j); im3=img4(i,j+1); im4=img8(i,j); im5=img9(i,j); im6=img7(i,j+1); im7=img2(i+1,j); im8=img3(i+1,j); im9=img1(i+1,j+1);
		im1=double(im1); im2=double(im2); im3=double(im3); im4=double(im4); im5=double(im5); im6=double(im6); im7=double(im7); im8=double(im8); im9=double(im9);
		[x]= lin_sis_solve (im1, im2, im3, im4, im5, im6, im7, im8, im9);
		n=n+1;
		ii=i+0.33;
		jj=j+0.33;
		img_out(round(3*ii)-2,round(3*jj)-2,n)=x(1);
		img_out(round(3*ii)-2,round(3*jj)-1,n)=x(2);
		img_out(round(3*ii)-2,round(3*jj),n)=x(3);
		img_out(round(3*ii)-2,round(3*jj)+1,n)=x(4);
		img_out(round(3*ii)-2,round(3*jj)+2,n)=x(5);
		img_out(round(3*ii)-1,round(3*jj)-2,n)=x(6);
		img_out(round(3*ii)-1,round(3*jj)-1,n)=x(7);
		img_out(round(3*ii)-1,round(3*jj),n)=x(8);
		img_out(round(3*ii)-1,round(3*jj)+1,n)=x(9);
		img_out(round(3*ii)-1,round(3*jj)+2,n)=x(10);
		img_out(round(3*ii),round(3*jj)-2,n)=x(11);
		img_out(round(3*ii),round(3*jj)-1,n)=x(12);
		img_out(round(3*ii),round(3*jj),n)=x(13);
		img_out(round(3*ii),round(3*jj)+1,n)=x(14);
		img_out(round(3*ii),round(3*jj)+2,n)=x(15);
		img_out(round(3*ii)+1,round(3*jj)-2,n)=x(16);
		img_out(round(3*ii)+1,round(3*jj)-1,n)=x(17);
		img_out(round(3*ii)+1,round(3*jj),n)=x(18);
		img_out(round(3*ii)+1,round(3*jj)+1,n)=x(19);
		img_out(round(3*ii)+1,round(3*jj)+2,n)=x(20);
		img_out(round(3*ii)+2,round(3*jj)-2,n)=x(21);
		img_out(round(3*ii)+2,round(3*jj)-1,n)=x(22);
		img_out(round(3*ii)+2,round(3*jj),n)=x(23);
		img_out(round(3*ii)+2,round(3*jj)+1,n)=x(24);
		img_out(round(3*ii)+2,round(3*jj)+2,n)=x(25);
%%%  6  %%%
		im1=img6(i,j); im2=img4(i,j+1); im3=img5(i,j+1); im4=img9(i,j); im5=img7(i,j+1); im6=img8(i,j+1); im7=img3(i+1,j); im8=img1(i+1,j+1); im9=img2(i+1,j+1);
		im1=double(im1); im2=double(im2); im3=double(im3); im4=double(im4); im5=double(im5); im6=double(im6); im7=double(im7); im8=double(im8); im9=double(im9);
		[x]= lin_sis_solve (im1, im2, im3, im4, im5, im6, im7, im8, im9);
		n=n+1;
		ii=i+0.33;
		jj=j+0.66;
img_out(round(3*ii)-2,round(3*jj)-2,n)=x(1); img_out(round(3*ii)-2,round(3*jj)-1,n)=x(2); img_out(round(3*ii)-2,round(3*jj),n)=x(3); img_out(round(3*ii)-2,round(3*jj)+1,n)=x(4); img_out(round(3*ii)-2,round(3*jj)+2,n)=x(5); img_out(round(3*ii)-1,round(3*jj)-2,n)=x(6); img_out(round(3*ii)-1,round(3*jj)-1,n)=x(7); img_out(round(3*ii)-1,round(3*jj),n)=x(8); img_out(round(3*ii)-1,round(3*jj)+1,n)=x(9); img_out(round(3*ii)-1,round(3*jj)+2,n)=x(10);
img_out(round(3*ii),round(3*jj)-2,n)=x(11); img_out(round(3*ii),round(3*jj)-1,n)=x(12); img_out(round(3*ii),round(3*jj),n)=x(13); img_out(round(3*ii),round(3*jj)+1,n)=x(14); img_out(round(3*ii),round(3*jj)+2,n)=x(15); img_out(round(3*ii)+1,round(3*jj)-2,n)=x(16); img_out(round(3*ii)+1,round(3*jj)-1,n)=x(17); img_out(round(3*ii)+1,round(3*jj),n)=x(18); img_out(round(3*ii)+1,round(3*jj)+1,n)=x(19); img_out(round(3*ii)+1,round(3*jj)+2,n)=x(20);
img_out(round(3*ii)+2,round(3*jj)-2,n)=x(21); img_out(round(3*ii)+2,round(3*jj)-1,n)=x(22); img_out(round(3*ii)+2,round(3*jj),n)=x(23); img_out(round(3*ii)+2,round(3*jj)+1,n)=x(24); img_out(round(3*ii)+2,round(3*jj)+2,n)=x(25);
%%%  7  %%%
im1=img7(i,j); im2=img8(i,j); im3=img9(i,j); im4=img1(i+1,j); im5=img2(i+1,j); im6=img3(i+1,j); im7=img4(i+1,j); im8=img5(i+1,j); im9=img6(i+1,j);
im1=double(im1); im2=double(im2); im3=double(im3); im4=double(im4); im5=double(im5); im6=double(im6); im7=double(im7); im8=double(im8); im9=double(im9);
[x]= lin_sis_solve (im1, im2, im3, im4, im5, im6, im7, im8, im9);
n=n+1;
ii=i+0.66;
jj=j;
img_out(round(3*ii)-2,round(3*jj)-2,n)=x(1); img_out(round(3*ii)-2,round(3*jj)-1,n)=x(2); img_out(round(3*ii)-2,round(3*jj),n)=x(3); img_out(round(3*ii)-2,round(3*jj)+1,n)=x(4); img_out(round(3*ii)-2,round(3*jj)+2,n)=x(5); img_out(round(3*ii)-1,round(3*jj)-2,n)=x(6); img_out(round(3*ii)-1,round(3*jj)-1,n)=x(7); img_out(round(3*ii)-1,round(3*jj),n)=x(8); img_out(round(3*ii)-1,round(3*jj)+1,n)=x(9); img_out(round(3*ii)-1,round(3*jj)+2,n)=x(10);
img_out(round(3*ii),round(3*jj)-2,n)=x(11); img_out(round(3*ii),round(3*jj)-1,n)=x(12); img_out(round(3*ii),round(3*jj),n)=x(13); img_out(round(3*ii),round(3*jj)+1,n)=x(14); img_out(round(3*ii),round(3*jj)+2,n)=x(15); img_out(round(3*ii)+1,round(3*jj)-2,n)=x(16); img_out(round(3*ii)+1,round(3*jj)-1,n)=x(17); img_out(round(3*ii)+1,round(3*jj),n)=x(18); img_out(round(3*ii)+1,round(3*jj)+1,n)=x(19); img_out(round(3*ii)+1,round(3*jj)+2,n)=x(20);
img_out(round(3*ii)+2,round(3*jj)-2,n)=x(21); img_out(round(3*ii)+2,round(3*jj)-1,n)=x(22); img_out(round(3*ii)+2,round(3*jj),n)=x(23); img_out(round(3*ii)+2,round(3*jj)+1,n)=x(24); img_out(round(3*ii)+2,round(3*jj)+2,n)=x(25);
%%%  8  %%%
im1=img8(i,j); im2=img9(i,j); im3=img7(i,j+1); im4=img2(i+1,j); im5=img3(i+1,j); im6=img1(i+1,j+1); im7=img5(i+1,j); im8=img6(i+1,j); im9=img4(i+1,j+1);
im1=double(im1); im2=double(im2); im3=double(im3); im4=double(im4); im5=double(im5); im6=double(im6); im7=double(im7); im8=double(im8); im9=double(im9);
[x]= lin_sis_solve (im1, im2, im3, im4, im5, im6, im7, im8, im9);
n=n+1;
ii=i+0.66;
jj=j+0.33;
img_out(round(3*ii)-2,round(3*jj)-2,n)=x(1); img_out(round(3*ii)-2,round(3*jj)-1,n)=x(2); img_out(round(3*ii)-2,round(3*jj),n)=x(3); img_out(round(3*ii)-2,round(3*jj)+1,n)=x(4); img_out(round(3*ii)-2,round(3*jj)+2,n)=x(5); img_out(round(3*ii)-1,round(3*jj)-2,n)=x(6); img_out(round(3*ii)-1,round(3*jj)-1,n)=x(7); img_out(round(3*ii)-1,round(3*jj),n)=x(8); img_out(round(3*ii)-1,round(3*jj)+1,n)=x(9); img_out(round(3*ii)-1,round(3*jj)+2,n)=x(10);
img_out(round(3*ii),round(3*jj)-2,n)=x(11); img_out(round(3*ii),round(3*jj)-1,n)=x(12); img_out(round(3*ii),round(3*jj),n)=x(13); img_out(round(3*ii),round(3*jj)+1,n)=x(14); img_out(round(3*ii),round(3*jj)+2,n)=x(15); img_out(round(3*ii)+1,round(3*jj)-2,n)=x(16); img_out(round(3*ii)+1,round(3*jj)-1,n)=x(17); img_out(round(3*ii)+1,round(3*jj),n)=x(18); img_out(round(3*ii)+1,round(3*jj)+1,n)=x(19); img_out(round(3*ii)+1,round(3*jj)+2,n)=x(20);
img_out(round(3*ii)+2,round(3*jj)-2,n)=x(21); img_out(round(3*ii)+2,round(3*jj)-1,n)=x(22); img_out(round(3*ii)+2,round(3*jj),n)=x(23); img_out(round(3*ii)+2,round(3*jj)+1,n)=x(24); img_out(round(3*ii)+2,round(3*jj)+2,n)=x(25);
%%%  9  %%%
im1=img9(i,j); im2=img7(i,j+1); im3=img8(i,j+1); im4=img3(i+1,j); im5=img1(i+1,j+1); im6=img2(i+1,j+1); im7=img6(i+1,j); im8=img4(i+1,j+1); im9=img5(i+1,j+1);
im1=double(im1); im2=double(im2); im3=double(im3); im4=double(im4); im5=double(im5); im6=double(im6); im7=double(im7); im8=double(im8); im9=double(im9);
[x]= lin_sis_solve (im1, im2, im3, im4, im5, im6, im7, im8, im9);
n=n+1;
ii=i+0.66;
jj=j+0.66;
img_out(round(3*ii)-2,round(3*jj)-2,n)=x(1); img_out(round(3*ii)-2,round(3*jj)-1,n)=x(2); img_out(round(3*ii)-2,round(3*jj),n)=x(3); img_out(round(3*ii)-2,round(3*jj)+1,n)=x(4); img_out(round(3*ii)-2,round(3*jj)+2,n)=x(5); img_out(round(3*ii)-1,round(3*jj)-2,n)=x(6); img_out(round(3*ii)-1,round(3*jj)-1,n)=x(7); img_out(round(3*ii)-1,round(3*jj),n)=x(8); img_out(round(3*ii)-1,round(3*jj)+1,n)=x(9); img_out(round(3*ii)-1,round(3*jj)+2,n)=x(10);
img_out(round(3*ii),round(3*jj)-2,n)=x(11); img_out(round(3*ii),round(3*jj)-1,n)=x(12); img_out(round(3*ii),round(3*jj),n)=x(13); img_out(round(3*ii),round(3*jj)+1,n)=x(14); img_out(round(3*ii),round(3*jj)+2,n)=x(15); img_out(round(3*ii)+1,round(3*jj)-2,n)=x(16); img_out(round(3*ii)+1,round(3*jj)-1,n)=x(17); img_out(round(3*ii)+1,round(3*jj),n)=x(18); img_out(round(3*ii)+1,round(3*jj)+1,n)=x(19); img_out(round(3*ii)+1,round(3*jj)+2,n)=x(20);
img_out(round(3*ii)+2,round(3*jj)-2,n)=x(21); img_out(round(3*ii)+2,round(3*jj)-1,n)=x(22); img_out(round(3*ii)+2,round(3*jj),n)=x(23); img_out(round(3*ii)+2,round(3*jj)+1,n)=x(24); img_out(round(3*ii)+2,round(3*jj)+2,n)=x(25);

end
end